spec: "1.0"

resources:
  TCPIP::192.168.1.100::INSTR:
    device: power_supply
  TCPIP::192.168.1.101::INSTR:
    device: signal_generator

devices:
  power_supply:
    dialogues:
      # Identification
      - q: "*IDN?"
        r: "SimPower,PS-1000,SN12345,1.0.0"

      # Reset and clear
      - q: "*RST"
        r: ""
      - q: "*CLS"
        r: ""

      # Operation complete
      - q: "*OPC?"
        r: "1"
      - q: "*WAI"
        r: ""

    properties:
      # Voltage setpoint
      voltage:
        default: 0.0
        getter:
          q: "VOLT?"
          r: "{:.6f}"
        setter:
          q: "VOLT {:.6f}"

      # Current limit
      current:
        default: 0.0
        getter:
          q: "CURR?"
          r: "{:.6f}"
        setter:
          q: "CURR {:.6f}"

      # Output state
      output:
        default: 0
        getter:
          q: "OUTP?"
          r: "{:d}"
        setter:
          q: "OUTP {:d}"
        specs:
          valid: [0, 1]
          type: int

    eom:
      TCPIP INSTR:
        q: "\n"
        r: "\n"

    error:
      response:
        q: "SYST:ERR?"
        r: '0,"No error"'

  signal_generator:
    dialogues:
      # Identification
      - q: "*IDN?"
        r: "SimGen,SG-2000,SN67890,1.0.0"

      # Reset and clear
      - q: "*RST"
        r: ""
      - q: "*CLS"
        r: ""

      # Operation complete
      - q: "*OPC?"
        r: "1"
      - q: "*WAI"
        r: ""

    properties:
      # Frequency setpoint (Hz)
      frequency:
        default: 1000000.0
        getter:
          q: "FREQ?"
          r: "{:.1f}"
        setter:
          q: "FREQ {:.1f}"

      # Power level (dBm)
      power:
        default: -10.0
        getter:
          q: "POW?"
          r: "{:.2f}"
        setter:
          q: "POW {:.2f}"

      # Output state
      output:
        default: 0
        getter:
          q: "OUTP?"
          r: "{:d}"
        setter:
          q: "OUTP {:d}"
        specs:
          valid: [0, 1]
          type: int

      # AM modulation properties
      am_source:
        default: "INT"
        setter:
          q: "AM:SOUR INT"
          r: ""

      am_frequency:
        default: 1000.0
        getter:
          q: "AM:INT:FREQ?"
          r: "{:.1f}"
        setter:
          q: "AM:INT:FREQ {:.1f}"

      am_depth:
        default: 50.0
        getter:
          q: "AM:DEPT?"
          r: "{:.1f}"
        setter:
          q: "AM:DEPT {:.1f}"

      am_state:
        default: 0
        getter:
          q: "AM:STAT?"
          r: "{:d}"
        setter:
          q: "AM:STAT {:d}"
        specs:
          valid: [0, 1]
          type: int

      # FM modulation properties
      fm_source:
        default: "INT"
        setter:
          q: "FM:SOUR INT"
          r: ""

      fm_frequency:
        default: 1000.0
        getter:
          q: "FM:INT:FREQ?"
          r: "{:.1f}"
        setter:
          q: "FM:INT:FREQ {:.1f}"

      fm_deviation:
        default: 5000.0
        getter:
          q: "FM:DEV?"
          r: "{:.1f}"
        setter:
          q: "FM:DEV {:.1f}"

      fm_state:
        default: 0
        getter:
          q: "FM:STAT?"
          r: "{:d}"
        setter:
          q: "FM:STAT {:d}"
        specs:
          valid: [0, 1]
          type: int

    eom:
      TCPIP INSTR:
        q: "\n"
        r: "\n"

    error:
      response:
        q: "SYST:ERR?"
        r: '0,"No error"'
